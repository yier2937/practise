import pandas as pd
from transformers import pipeline
import torch

df = pd.read_excel("test.csv")

# Load pre-trained sentiment analysis model
sentiment_model = pipeline("sentiment-analysis", model="distilbert-base-uncased-finetuned-sst-2-english", device=device)

# Apply sentiment analysis in batches
batch_size = 32
results = []
for i in range(0, len(df), batch_size):
    texts = df['body'].iloc[i:i+batch_size].astype(str).tolist()
    predictions = sentiment_model(texts)
    results.extend([pred['label'] for pred in predictions])

# Convert results to sentiment categories
df['sentiment'] = ['Positive' if label == 'POSITIVE' else 'Negative' for label in results]

df.to_csv("labeled_output.csv", index=False)
